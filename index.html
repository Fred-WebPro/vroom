<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rent SuperApp</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        darkBg: '#111827',
                        darkCard: '#1f2937',
                    }
                }
            }
        }
    </script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-darkBg dark:text-gray-100 transition-colors duration-200">

    <div id="app" class="min-h-screen pb-20"></div>

    <div id="modal-container" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>
        <div id="modal-content" class="absolute bottom-0 left-0 right-0 bg-white dark:bg-darkBg rounded-t-3xl min-h-[85vh] max-h-[95vh] overflow-y-auto slide-up shadow-2xl">
            </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –î–ê–ù–ù–´–ï ---
        const CITIES = [
            { id: 'msk', name_ru: '–ú–æ—Å–∫–≤–∞', name_en: 'Moscow', flag: 'üá∑üá∫', currency: 'RUB' },
            { id: 'baku', name_ru: '–ë–∞–∫—É', name_en: 'Baku', flag: 'üá¶üáø', currency: 'AZN' },
            { id: 'dxb', name_ru: '–î—É–±–∞–π', name_en: 'Dubai', flag: 'üá¶üá™', currency: 'AED' },
        ];

        const TRANSLATIONS = {
            ru: { start: "–ù–∞—á–∞—Ç—å", select_lang: "–Ø–∑—ã–∫", select_city: "–ì–æ—Ä–æ–¥", back: "–ù–∞–∑–∞–¥", book: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å", price: "–¶–µ–Ω–∞", total: "–ò—Ç–æ–≥–æ", days: "–î–Ω–µ–π", success: "–£—Å–ø–µ—à–Ω–æ!", success_desc: "–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞." },
            en: { start: "Start", select_lang: "Language", select_city: "City", back: "Back", book: "Book Now", price: "Price", total: "Total", days: "Days", success: "Success!", success_desc: "Request sent." }
        };

        const ITEMS = [
            { id: 1, type: 'auto', tier: 'economy', city: 'msk', title: 'Hyundai Solaris', price: 2500, rating: 4.8, reviews: 120, partner: 'CityDrive', image: 'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?auto=format&fit=crop&w=500&q=60' },
            { id: 2, type: 'auto', tier: 'premium', city: 'msk', title: 'Mercedes E-Class', price: 8000, rating: 5.0, reviews: 45, partner: 'EliteCars', image: 'https://images.unsplash.com/photo-1617788138017-80ad40651399?auto=format&fit=crop&w=500&q=60' },
            { id: 3, type: 'auto', tier: 'comfort', city: 'baku', title: 'Toyota Camry', price: 60, rating: 4.7, reviews: 89, partner: 'BakuRent', image: 'https://images.unsplash.com/photo-1626077388041-33311f8560f7?auto=format&fit=crop&w=500&q=60' },
            { id: 4, type: 'real_estate', tier: 'premium', city: 'dxb', title: 'Marina View Loft', price: 1200, rating: 4.9, reviews: 320, partner: 'DubaiStay', image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=500&q=60' },
            { id: 6, type: 'food', tier: '$$$', city: 'baku', title: 'Chinar', price: 150, rating: 4.9, reviews: 500, partner: 'Saffron Group', image: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=500&q=60' },
        ];

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        let state = {
            lang: 'ru',
            city: CITIES[1], // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ë–∞–∫—É
            category: 'auto',
            tier: 'all',
            isOnboarding: true,
            theme: tg.colorScheme || 'light'
        };

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function init() {
            applyTheme();
            render();
            
            // –°–ª—É—à–∞–µ–º –∫–Ω–æ–ø–∫—É –ù–∞–∑–∞–¥
            tg.BackButton.onClick(() => {
                closeModal();
            });
        }

        function applyTheme() {
            if (state.theme === 'dark') {
                document.documentElement.classList.add('dark');
                tg.setHeaderColor('#111827');
            } else {
                document.documentElement.classList.remove('dark');
                tg.setHeaderColor('#ffffff');
            }
        }

        // --- –†–ï–ù–î–ï–†–ò–ù–ì ---
        function render() {
            const app = document.getElementById('app');
            
            if (state.isOnboarding) {
                app.innerHTML = renderOnboarding();
                lucide.createIcons();
                tg.BackButton.hide();
                return;
            }

            // –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω
            app.innerHTML = `
                ${renderHeader()}
                ${renderTabs()}
                ${renderFilters()}
                ${renderGrid()}
            `;
            lucide.createIcons();
            tg.BackButton.hide();
        }

        // 1. –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        function renderOnboarding() {
            const t = TRANSLATIONS[state.lang];
            return `
                <div class="flex flex-col items-center justify-center min-h-screen p-6 space-y-8 fade-in">
                    <h1 class="text-3xl font-bold">Vroom App</h1>
                    
                    <div class="w-full max-w-xs space-y-2">
                        <label class="text-sm text-gray-500 font-medium">Language / –Ø–∑—ã–∫</label>
                        <div class="grid grid-cols-2 gap-2 bg-gray-200 dark:bg-gray-800 p-1 rounded-xl">
                            <button onclick="setLang('ru')" class="p-3 rounded-lg text-sm font-bold transition-all ${state.lang === 'ru' ? 'bg-white dark:bg-gray-600 shadow' : 'text-gray-500'}">RU</button>
                            <button onclick="setLang('en')" class="p-3 rounded-lg text-sm font-bold transition-all ${state.lang === 'en' ? 'bg-white dark:bg-gray-600 shadow' : 'text-gray-500'}">EN</button>
                        </div>
                    </div>

                    <div class="w-full max-w-xs space-y-2">
                        <label class="text-sm text-gray-500 font-medium">${t.select_city}</label>
                        <div class="space-y-2">
                            ${CITIES.map(c => `
                                <button onclick="setCity('${c.id}')" class="w-full flex items-center justify-between p-4 rounded-xl border transition-all ${state.city.id === c.id ? 'border-primary bg-primary/10 ring-1 ring-primary' : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-darkCard'}">
                                    <span class="flex items-center gap-3">
                                        <span class="text-2xl">${c.flag}</span>
                                        <span class="font-medium text-lg">${state.lang === 'ru' ? c.name_ru : c.name_en}</span>
                                    </span>
                                    ${state.city.id === c.id ? '<i data-lucide="check" class="text-primary w-5 h-5"></i>' : ''}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <button onclick="finishOnboarding()" class="w-full max-w-xs bg-primary text-white py-4 rounded-xl font-bold text-lg shadow-lg active:scale-95 transition-transform mt-4">
                        ${t.start}
                    </button>
                </div>
            `;
        }

        // 2. –®–∞–ø–∫–∞
        function renderHeader() {
            return `
                <div class="flex items-center justify-between p-4 sticky top-0 bg-gray-50/90 dark:bg-darkBg/90 backdrop-blur z-40">
                    <div class="flex items-center gap-3">
                        <span class="text-4xl shadow-sm rounded-full bg-white dark:bg-gray-800 w-12 h-12 flex items-center justify-center">${state.city.flag}</span>
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">${state.lang === 'ru' ? state.city.name_ru : state.city.name_en}</p>
                            <p class="font-bold text-xl leading-none">Vroom</p>
                        </div>
                    </div>
                    <button onclick="toggleTheme()" class="p-3 bg-white dark:bg-gray-700 rounded-full shadow-sm active:scale-90 transition-transform">
                        <i data-lucide="${state.theme === 'light' ? 'moon' : 'sun'}" class="w-5 h-5"></i>
                    </button>
                </div>
            `;
        }

        // 3. –¢–∞–±—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function renderTabs() {
            const cats = [
                { id: 'auto', icon: 'car', label_ru: '–ê–≤—Ç–æ', label_en: 'Auto' },
                { id: 'real_estate', icon: 'home', label_ru: '–ñ–∏–ª—å–µ', label_en: 'Home' },
                { id: 'food', icon: 'utensils', label_ru: '–ï–¥–∞', label_en: 'Food' }
            ];
            
            return `
                <div class="flex gap-3 px-4 mb-6 overflow-x-auto no-scrollbar pb-2">
                    ${cats.map(c => `
                        <button onclick="setCategory('${c.id}')" class="flex flex-col items-center justify-center min-w-[85px] h-20 rounded-2xl transition-all duration-200 ${state.category === c.id ? 'bg-primary text-white shadow-lg scale-105' : 'bg-white dark:bg-darkCard text-gray-400'}">
                            <i data-lucide="${c.icon}" class="mb-1 w-6 h-6"></i>
                            <span class="text-xs font-bold">${state.lang === 'ru' ? c.label_ru : c.label_en}</span>
                        </button>
                    `).join('')}
                </div>
            `;
        }

        // 4. –§–∏–ª—å—Ç—Ä—ã
        function renderFilters() {
            const tiers = ['economy', 'comfort', 'premium'];
            return `
                <div class="flex gap-2 px-4 mb-6 overflow-x-auto no-scrollbar">
                    <button onclick="setTier('all')" class="px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${state.tier === 'all' ? 'bg-gray-900 text-white dark:bg-white dark:text-black' : 'bg-gray-200 dark:bg-gray-800 text-gray-500'}">All</button>
                    ${tiers.map(t => `
                        <button onclick="setTier('${t}')" class="px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap capitalize transition-colors ${state.tier === t ? 'bg-gray-900 text-white dark:bg-white dark:text-black' : 'bg-gray-200 dark:bg-gray-800 text-gray-500'}">
                            ${t}
                        </button>
                    `).join('')}
                </div>
            `;
        }

        // 5. –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        function renderGrid() {
            const filtered = ITEMS.filter(item => 
                item.city === state.city.id && 
                item.type === state.category && 
                (state.tier === 'all' || item.tier === state.tier)
            );

            if (filtered.length === 0) {
                return `<div class="text-center py-20 text-gray-400 px-10">
                    <i data-lucide="search-x" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                    <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
                </div>`;
            }

            return `
                <div class="px-4 pb-24 grid gap-4">
                    ${filtered.map(item => `
                        <div onclick="openItem(${item.id})" class="bg-white dark:bg-darkCard rounded-3xl p-3 shadow-sm active:scale-[0.98] transition-transform cursor-pointer">
                            <div class="relative h-44 w-full mb-3">
                                <img src="${item.image}" class="w-full h-full object-cover rounded-2xl" loading="lazy">
                                <div class="absolute top-3 right-3 bg-white/90 dark:bg-black/60 backdrop-blur px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1">
                                    <i data-lucide="star" class="w-3 h-3 text-yellow-500 fill-yellow-500"></i>
                                    ${item.rating}
                                </div>
                            </div>
                            <div class="px-1 mb-2">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-lg leading-tight text-gray-900 dark:text-gray-100">${item.title}</h3>
                                        <p class="text-xs text-gray-400 mt-1 uppercase font-semibold tracking-wide">${item.partner}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="block font-bold text-primary text-lg">${item.price} ${state.city.currency}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // --- –õ–û–ì–ò–ö–ê ---
        function setLang(l) { state.lang = l; render(); }
        function setCity(id) { state.city = CITIES.find(c => c.id === id); render(); }
        function finishOnboarding() { state.isOnboarding = false; render(); }
        function toggleTheme() { state.theme = state.theme === 'light' ? 'dark' : 'light'; applyTheme(); render(); }
        function setCategory(id) { state.category = id; state.tier = 'all'; render(); }
        function setTier(t) { state.tier = t; render(); }

        // --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–î–ï–¢–ê–õ–ò) ---
        let currentItem = null;
        let daysCount = 1;

        function openItem(id) {
            currentItem = ITEMS.find(i => i.id === id);
            daysCount = 1;
            const t = TRANSLATIONS[state.lang];
            const modal = document.getElementById('modal-container');
            const content = document.getElementById('modal-content');

            content.innerHTML = `
                <div class="relative h-72">
                    <img src="${currentItem.image}" class="w-full h-full object-cover">
                    <button onclick="closeModal()" class="absolute top-4 right-4 bg-black/50 text-white p-2 rounded-full backdrop-blur">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <div class="p-6 pb-10">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="text-[10px] font-bold text-primary bg-blue-100 dark:bg-blue-900/30 px-2 py-1 rounded uppercase tracking-wider">${currentItem.tier}</span>
                            <h2 class="text-3xl font-bold mt-2">${currentItem.title}</h2>
                        </div>
                        <div class="text-right">
                            <span class="text-2xl font-bold text-primary">${currentItem.price} <span class="text-sm text-gray-500">${state.city.currency}</span></span>
                        </div>
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl mb-6 flex items-center gap-4">
                        <div class="w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center">
                            <i data-lucide="briefcase" class="w-5 h-5 text-gray-500"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 uppercase font-bold">Partner</p>
                            <p class="font-bold">${currentItem.partner}</p>
                        </div>
                    </div>

                    ${currentItem.type !== 'food' ? `
                    <div class="mb-8">
                        <label class="block text-sm font-bold text-gray-500 mb-3">${t.days}</label>
                        <div class="flex items-center justify-between bg-gray-100 dark:bg-gray-800 p-2 rounded-2xl">
                            <button onclick="changeDays(-1)" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-gray-700 rounded-xl shadow-sm text-xl font-bold">-</button>
                            <span id="days-display" class="font-bold text-2xl">${daysCount}</span>
                            <button onclick="changeDays(1)" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-gray-700 rounded-xl shadow-sm text-xl font-bold">+</button>
                        </div>
                    </div>
                    ` : ''}

                    <div class="border-t dark:border-gray-700 pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-gray-500 font-medium">${t.total}:</span>
                            <span id="total-price" class="text-3xl font-bold">${currentItem.price} ${state.city.currency}</span>
                        </div>
                        <button onclick="doBook()" class="w-full bg-primary text-white py-4 rounded-xl font-bold text-xl shadow-lg active:scale-95 transition-transform">
                            ${t.book}
                        </button>
                    </div>
                </div>
            `;
            
            lucide.createIcons();
            modal.classList.remove('hidden');
            tg.BackButton.show();
        }

        function closeModal() {
            document.getElementById('modal-container').classList.add('hidden');
            tg.BackButton.hide();
        }

        function changeDays(delta) {
            if (daysCount + delta < 1) return;
            daysCount += delta;
            document.getElementById('days-display').innerText = daysCount;
            document.getElementById('total-price').innerText = (currentItem.price * daysCount) + ' ' + state.city.currency;
        }

        function doBook() {
            const t = TRANSLATIONS[state.lang];
            tg.showPopup({
                title: t.success,
                message: `${t.success_desc}\nOrder: ${currentItem.title} (${daysCount} days)`,
                buttons: [{type: "ok"}]
            }, () => {
                closeModal();
            });
        }

        // –ó–∞–ø—É—Å–∫
        init();

    </script>
</body>
</html>
